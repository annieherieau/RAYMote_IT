<style>
.star-rating {
  font-size: 24px;
}

.star-rating .star {
  cursor: pointer;
  color: #ccc; 
}

.star-rating .star.rated {
  color: #f5a623; 
}
</style>

<%= form_with(model: [ @workshop, review ], local: true) do |form| %>
  <% if review.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(review.errors.count, "error") %> prohibited this review from being saved:</h2>

      <ul>
        <% review.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :content, style: "display: block" %>
    <%= form.text_area :content %>
  </div>

  <div class="star-rating">
  <% (1..5).each do |rating| %>
    <span class="star" data-rating="<%= rating %>">&#9733;</span>
  <% end %>
</div>
<%= form.hidden_field :rating, id: 'rating_field', value: @review.rating %>

  <div>
    <%= form.submit %>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var stars = document.querySelectorAll('.star');
    var ratingField = document.getElementById('rating_field');
    var currentRating = parseInt(ratingField.value, 10);

    function updateStars(rating) {
        stars.forEach(function(star, index) {
            if (index < rating) {
                star.classList.add('rated');
            } else {
                star.classList.remove('rated');
            }
        });
    }

    function resetStars() {
        updateStars(currentRating || 0);
    }

    stars.forEach(function(star, index) {
        star.addEventListener('click', function() {
            var rating = index + 1;
            ratingField.value = rating;
            currentRating = rating;
            updateStars(rating);
        });

        star.addEventListener('mouseover', function() {
            updateStars(index + 1);
        });
    });

    document.querySelector('.star-rating').addEventListener('mouseleave', resetStars);

    if (!isNaN(currentRating) && currentRating > 0) {
        updateStars(currentRating);
    }
});

</script>
